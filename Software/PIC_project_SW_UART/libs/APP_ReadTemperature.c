#include "BSW_ReadADC.h"
#include "APP_ReadTemperature.h"

// Tabela 16X overampling at 2K4 +100R and 5V
unsigned int T16bit[TABLE_LEN]={0x0D38,0x0D4E,0x0D63,0x0D79,0x0D8F,0x0DA5,0x0DBB,0x0DD1,0x0DE8,0x0DFE,0x0E14,0x0E2B,0x0E41,0x0E58,0x0E6E,0x0E85,0x0E9C,0x0EB2,0x0EC9,0x0EE0, 
                                      0x0EF7,0x0F0E,0x0F25,0x0F3C,0x0F53,0x0F6A,0x0F82,0x0F99,0x0FB0,0x0FC8,0x0FDF,0x0FF7,0x100E,0x1026,0x103D,0x1055,0x106D,0x1084,0x109C,0x10B4, 
                                      0x10CC,0x10E4,0x10FC,0x1114,0x112C,0x1144,0x115C,0x1174,0x118C,0x11A4,0x11BC,0x11D4,0x11EC,0x1205,0x121D,0x1235,0x124D,0x1266,0x127E,0x1296, 
                                      0x12AF,0x12C7,0x12DF,0x12F8,0x1310,0x1329,0x1341,0x1359,0x1372,0x138A,0x13A3,0x13BB,0x13D4,0x13EC,0x1405,0x141D,0x1436,0x144E,0x1467,0x147F, 
                                      0x1498,0x14B0,0x14C9,0x14E1,0x14FA,0x1512,0x152B,0x1543,0x155C,0x1574,0x158D,0x15A5,0x15BE,0x15D6,0x15EF,0x1607,0x1620,0x1638,0x1651,0x1669, 
                                      0x1681,0x169A,0x16B2,0x16CB,0x16E3,0x16FB,0x1714,0x172C,0x1744,0x175C,0x1775,0x178D,0x17A5,0x17BD,0x17D5,0x17EE,0x1806,0x181E,0x1836,0x184E, 
                                      0x1866,0x187E,0x1896,0x18AE,0x18C6,0x18DE,0x18F6,0x190E,0x1925,0x193D,0x1955,0x196D,0x1985,0x199C,0x19B4,0x19CC,0x19E3,0x19FB,0x1A12,0x1A2A, 
                                      0x1A41,0x1A59,0x1A70,0x1A88,0x1A9F,0x1AB6,0x1ACE,0x1AE5,0x1AFC,0x1B13,0x1B2A,0x1B41,0x1B59,0x1B70,0x1B87,0x1B9E,0x1BB5,0x1BCB,0x1BE2,0x1BF9, 
                                      0x1C10,0x1C27,0x1C3D,0x1C54,0x1C6B,0x1C81,0x1C98,0x1CAE,0x1CC5,0x1CDB,0x1CF2,0x1D08,0x1D1E,0x1D35,0x1D4B,0x1D61,0x1D77,0x1D8D,0x1DA3,0x1DB9, 
                                      0x1DCF,0x1DE5,0x1DFB,0x1E11,0x1E27,0x1E3D,0x1E52,0x1E68,0x1E7E,0x1E93,0x1EA9,0x1EBE,0x1ED4,0x1EE9,0x1EFE,0x1F14,0x1F29,0x1F3E,0x1F53,0x1F69};


//unsigned char Temperature[ADC_ChanalNo];
int TdC(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    signed int temp = -50;
    unsigned char cnt =1;
//    tp_temp = tp_temp >> 4;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
        temp++;
    }
    if (temp > -20)
        temp = temp *10 +((tp_temp -T16bit[cnt -1])*10)/(T16bit[cnt] -T16bit[cnt -1]);
    else
        temp = -999;
    return(temp);
}

int TcPak(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    signed int temp = -50;
    unsigned char cnt =1;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
        temp++;
    }
    return(temp);
}


unsigned char Temperatura(unsigned int tp_temp)    //Temperatura iz LOOK-up tabele
{
    unsigned char cnt =1;
    while ((T16bit[cnt] < tp_temp)&&(cnt < TABLE_LEN))
    {
        cnt++;
    }
    return(cnt);
}

void CalcTemps()
{
    unsigned char cnt;
    for(cnt=0; cnt<ADC_ChanalNo; cnt++)
    {
    	Temperature[cnt] = TcPak(ADC_result[cnt]);
    } 

}
